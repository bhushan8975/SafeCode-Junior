import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as C,s as k,d as S}from"./firebaseConfig-oADvoGp-.js";import{createUserWithEmailAndPassword as P,updateProfile as V}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";import{setDoc as B,doc as E}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";import{ref as R,uploadBytes as U,getDownloadURL as x}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";import{r as O}from"./voiceBiometric-Bu1dBzvN.js";import"https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";const a=document.getElementById("signup-btn"),u=document.getElementById("back-login"),n=document.getElementById("recordVoiceBtn"),c=document.getElementById("voiceStatus"),m=document.getElementById("name"),g=document.getElementById("email"),f=document.getElementById("password"),p=document.getElementById("mobile"),h=document.getElementById("profile-pic");a||console.warn("signup.js: missing expected DOM elements. Make sure signup.html has #signup-btn.");function I(){if(!navigator.onLine)throw alert("âš ï¸ You are offline. Please connect to the internet and try again."),new Error("Offline - network not available")}function T(e){return e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_\-\.]/g,"")}a==null||a.addEventListener("click",async()=>{var y,v;const e=(m==null?void 0:m.value.trim())??"",l=(g==null?void 0:g.value.trim())??"",r=(f==null?void 0:f.value.trim())??"",w=(p==null?void 0:p.value.trim())??"",d=(y=h==null?void 0:h.files)==null?void 0:y[0];if(!e||!l||!r||!w){alert("âš ï¸ Please fill all required fields.");return}try{I(),a.disabled=!0,a.innerText="ðŸ”„ Creating account...";const i=(await P(C,l,r)).user;console.log("âœ… User created:",i.uid);let s="../assets/default-avatar.png";if(d&&k)try{console.log("ðŸ“¸ Uploading profile photo...");const t=`${Date.now()}_${T(d.name)}`,b=R(k,`profilePhotos/${i.uid}/${t}`);await U(b,d),s=await x(b),console.log("âœ… Profile photo uploaded:",s)}catch(t){console.error("âŒ Profile photo upload failed:",t),(v=t==null?void 0:t.message)!=null&&v.includes("Network")||(t==null?void 0:t.code)==="storage/canceled"||(t==null?void 0:t.code)==="auth/network-request-failed"?alert(`âš ï¸ Photo upload failed due to network/CORS. Your account was still created â€” profile photo will use the default avatar.

To fix uploads during development, set Bucket CORS to allow http://localhost:5173 (use gsutil to set CORS).`):alert("âš ï¸ Photo upload failed. Using default avatar instead."),s="../assets/default-avatar.png"}try{await V(i,{displayName:e,photoURL:s})}catch(t){console.warn("âš ï¸ updateProfile failed (non-blocking):",t)}await B(E(S,"users",i.uid),{name:e,email:l,mobile:w,photoURL:s,createdAt:new Date().toISOString()}),console.log("âœ… User data saved in Firestore"),alert("âœ… Account created! You can now set up voice biometric (optional)."),n&&(n.disabled=!1,c.textContent="ðŸŽ™ï¸ Click 'Record Voice' to calibrate your voice.")}catch(o){console.error("âŒ Signup failed:",o);const i=o!=null&&o.code?{"auth/network-request-failed":"Network error â€” please check your internet or CORS settings.","auth/email-already-in-use":"Email already registered. Try logging in.","auth/invalid-email":"Invalid email format."}[o.code]||o.message:o.message||String(o);alert("âŒ Signup failed: "+i)}finally{a.disabled=!1,a.innerText="Sign Up"}});n==null||n.addEventListener("click",async()=>{try{const e=C.currentUser;if(!e){alert("âš ï¸ Please sign up or login first before recording your voice.");return}n.disabled=!0,c.textContent="ðŸŽ§ Recording... please speak clearly.";const l=await O(4e3);console.log("ðŸŽ™ï¸ Voice recorded Blob:",l);const r=Array.from({length:16},()=>Math.random());await B(E(S,"voiceprints",e.uid),{vector:r}),console.log("âœ… Voice vector saved (mock):",r),c.textContent="âœ… Voice calibration complete!",alert("âœ… Voice setup done! You can now log in with your voice."),setTimeout(()=>window.location.href="../pages/login.html",1200)}catch(e){console.error("âŒ Voice calibration failed:",e),alert("âŒ Voice setup failed: "+((e==null?void 0:e.message)||e)),c.textContent="âŒ Voice calibration failed. Try again.",n.disabled=!1}});u==null||u.addEventListener("click",()=>{window.location.href="../pages/login.html"});console.log("âœ… signup.js loaded successfully");
