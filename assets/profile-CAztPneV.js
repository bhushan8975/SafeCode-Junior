import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as n,d as l,s as c}from"./firebaseConfig-oADvoGp-.js";import{onAuthStateChanged as m,updateProfile as s,signOut as u}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";import{doc as r,getDoc as f,updateDoc as d}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";import{ref as p,uploadBytes as g,getDownloadURL as h}from"https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";import"https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";m(n,async e=>{e?(console.log("‚úÖ Logged in as:",e.email),y(e)):(console.warn("üö´ No user logged in ‚Äî redirecting to login in 2s..."),setTimeout(()=>{n.currentUser||(window.location.href="login.html")},2e3))});async function y(e){document.getElementById("email").value=e.email||"",document.getElementById("name").value=e.displayName||"",document.getElementById("profileImage").src=e.photoURL||"../assets/default-avatar.png";const t=r(l,"users",e.uid),a=await f(t);if(a.exists()){const o=a.data();o.mobile&&(document.getElementById("mobile").value=o.mobile),o.photoURL&&(document.getElementById("profileImage").src=o.photoURL)}}window.saveProfile=async function(){const e=n.currentUser;if(!e)return alert("Please log in first.");const t=document.getElementById("name").value,a=document.getElementById("mobile").value,o=document.getElementById("profileImage").src;try{await s(e,{displayName:t,photoURL:o}),await d(r(l,"users",e.uid),{name:t,mobile:a,photoURL:o}),alert("‚úÖ Profile updated successfully!")}catch(i){console.error("Update failed:",i),alert("‚ö†Ô∏è Failed to update profile. Try again.")}};window.uploadPhoto=async function(e){const t=n.currentUser,a=e.target.files[0];if(!(!t||!a))try{const o=p(c,"profile_photos/"+t.uid);await g(o,a);const i=await h(o);await s(t,{photoURL:i}),await d(r(l,"users",t.uid),{photoURL:i}),document.getElementById("profileImage").src=i,alert("‚úÖ Profile photo updated!")}catch(o){console.error("Photo upload failed:",o),alert("‚ö†Ô∏è Photo upload failed.")}};window.logoutUser=async function(){await u(n),window.location.href="login.html"};
